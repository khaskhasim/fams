{% extends "layout.html" %}
{% block title %}TR-069 / ACS Server{% endblock %}

{% block content %}

<!-- ================= HEADER ================= -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-slate-800 dark:text-slate-100">
      TR-069 / ACS Server
    </h1>
    <p class="text-sm text-slate-500 dark:text-slate-400">
      Manajemen server GenieACS / TR-069
    </p>
  </div>

  <a href="/tr069/add"
     class="inline-flex items-center gap-2
            px-5 py-2.5 rounded-xl
            bg-gradient-to-r from-blue-600 to-indigo-600
            hover:from-blue-700 hover:to-indigo-700
            text-white font-semibold shadow-lg">
    <svg class="w-5 h-5" fill="none" stroke="currentColor"
         viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 4v16m8-8H4"/>
    </svg>
    Add Server
  </a>
</div>

<!-- ================= TABLE ================= -->
<div class="rounded-2xl overflow-hidden shadow-xl
            bg-white dark:bg-slate-800
            border border-slate-200 dark:border-slate-700">

<table class="w-full text-sm">

<thead class="bg-slate-100 dark:bg-slate-900
              text-slate-600 dark:text-slate-400
              text-xs uppercase">
<tr>
  <th class="px-6 py-4 text-left">Name</th>
  <th class="px-6 py-4 text-left">Base URL</th>
  <th class="px-6 py-4 text-center">Status</th>
  <th class="px-6 py-4 text-center">Actions</th>
</tr>
</thead>

<tbody class="divide-y divide-slate-200 dark:divide-slate-700">

{% for r in rows %}
<tr class="hover:bg-slate-50 dark:hover:bg-slate-700">

  <td class="px-6 py-4 font-semibold text-slate-800 dark:text-slate-100">
    {{ r.name }}
  </td>

  <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-300">
    {{ r.base_url }}
  </td>

  <td class="px-6 py-4 text-center">
    {% if r.is_active %}
      <span class="inline-flex items-center gap-1
                   px-3 py-1 rounded-full text-xs font-semibold
                   bg-emerald-100 text-emerald-700
                   dark:bg-emerald-900/40 dark:text-emerald-400">
        ACTIVE
      </span>
    {% else %}
      <span class="inline-flex items-center gap-1
                   px-3 py-1 rounded-full text-xs font-semibold
                   bg-slate-200 text-slate-600
                   dark:bg-slate-700 dark:text-slate-400">
        DISABLED
      </span>
    {% endif %}
  </td>

  <!-- ACTIONS -->
  <td class="px-6 py-4 text-center">
    <div class="inline-flex gap-2">

      <!-- OVERVIEW -->
      <a href="/tr069/overview"
         class="inline-flex items-center gap-1.5
                px-3 py-1.5 rounded-lg text-xs font-semibold
                bg-purple-600 text-white
                hover:bg-purple-700 shadow-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor"
             viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M11.25 3.75v16.5
                   A8.25 8.25 0 003.75 12h7.5z"/>
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M12.75 3.75
                   A8.25 8.25 0 0121 12h-8.25z"/>
        </svg>
        Overview
      </a>

      <!-- DEVICES -->
      <a href="/tr069/{{ r.id }}/devices"
         class="inline-flex items-center gap-1.5
                px-3 py-1.5 rounded-lg text-xs font-semibold
                bg-indigo-600 text-white
                hover:bg-indigo-700 shadow-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor"
             viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 7l9 5 9-5-9-5-9 5z"/>
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 12l9 5 9-5"/>
        </svg>
        Devices
      </a>

      <!-- TEST -->
      <form action="/tr069/{{ r.id }}/test" method="post" class="inline">
        <button type="submit"
                class="inline-flex items-center gap-1.5
                       px-3 py-1.5 rounded-lg text-xs font-semibold
                       bg-emerald-600 text-white
                       hover:bg-emerald-700 shadow-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor"
               viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 6v6m6-6v6
                     M5 12h14
                     a2 2 0 01-2 2v2
                     a3 3 0 01-6 0v-2"/>
          </svg>
          Test
        </button>
      </form>

      <!-- EDIT -->
      <a href="/tr069/{{ r.id }}/edit"
         class="inline-flex items-center gap-1.5
                px-3 py-1.5 rounded-lg text-xs font-semibold
                bg-amber-500 text-white
                hover:bg-amber-600 shadow-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor"
             viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M15.232 5.232l3.536 3.536
                   M9 11l6-6
                   M4 20h4l10-10"/>
        </svg>
        Edit
      </a>

      <!-- DELETE -->
      <button type="button"
              onclick="openDeleteModal('{{ r.id }}','{{ r.name }}')"
              class="inline-flex items-center gap-1.5
                     px-3 py-1.5 rounded-lg text-xs font-semibold
                     bg-rose-600 text-white
                     hover:bg-rose-700 shadow-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor"
             viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M6 7h12
                   M9 7V5h6v2
                   M10 11v6m4-6v6"/>
        </svg>
        Delete
      </button>

    </div>
  </td>

</tr>
{% else %}
<tr>
  <td colspan="4"
      class="px-6 py-12 text-center
             text-slate-400 dark:text-slate-500">
    Belum ada server TR-069
  </td>
</tr>
{% endfor %}

</tbody>
</table>
</div>

<!-- ================= DELETE MODAL ================= -->
<div id="deleteModal"
     class="fixed inset-0 z-50 hidden items-center justify-center">

  <div class="absolute inset-0 bg-black/50"></div>

  <div class="relative w-full max-w-md
              bg-white dark:bg-slate-800
              rounded-2xl shadow-xl p-6">

    <h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-2">
      Hapus Server TR-069
    </h3>

    <p class="text-sm text-slate-600 dark:text-slate-400 mb-6">
      Server
      <span id="deleteTargetName"
            class="font-semibold text-slate-800 dark:text-slate-200"></span>
      akan dihapus dan tidak dapat dikembalikan.
    </p>

    <div class="flex justify-end gap-3">
      <button onclick="closeDeleteModal()"
              class="px-4 py-2 rounded-lg text-sm font-semibold
                     bg-slate-200 text-slate-700
                     hover:bg-slate-300
                     dark:bg-slate-700 dark:text-slate-300">
        Batal
      </button>

      <form id="deleteForm" method="post">
        <button type="submit"
                class="px-4 py-2 rounded-lg text-sm font-semibold
                       bg-red-600 text-white
                       hover:bg-red-700">
          Ya, Hapus
        </button>
      </form>
    </div>

  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
function openDeleteModal(id, name) {
  document.getElementById('deleteTargetName').innerText = name
  document.getElementById('deleteForm').action = `/tr069/${id}/delete`

  const modal = document.getElementById('deleteModal')
  modal.classList.remove('hidden')
  modal.classList.add('flex')
}

function closeDeleteModal() {
  const modal = document.getElementById('deleteModal')
  modal.classList.add('hidden')
  modal.classList.remove('flex')
}
</script>

{% endblock %}
